![线程的生命周期](https://cdn.jsdelivr.net/gh/ArrayTeng/resources/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png)

[面试官：说说多线程并发问题](https://www.jianshu.com/p/da2dabfce94e)

#### 多线程为什么会有并发问题，为什么多个线程对同一个变量进行操作会有并发问题？

java内存模型规定了所有变量都存储在主内存中，每条线程由自己的工作内存

线程的工作内存中保存了该线程中用到的变量的主内存副本拷贝，线程对变量的所有的操作必须在工作内存中进行，而不能直接读写主内存

线程访问一个变量，首先将变量从主内存拷贝到工作内存中，对变量的操作不会马上同步到主内存

不同的线程之间也无法直接访问对方工作内存中的变量，线程间的变量传递需要自己的工作内存和主内存之间进行数据同步

#### 并发编程的三要素

原子性：可以理解为在一个操作中，CPU不可以在中途暂停然后在调度，不可以被中断操作，要么执行完，要么就不执行。

可见性：多个线程访问同一个变量的时候，一个线程修改了这个变量的值，那么其它线程能够立即看到修改的值

有序性：程序的执行的顺序是按照代码的先后顺序执行



#### 进程与线程的区别

进程是操作系统进行资源分配的最小单元，其中的资源包括CPU、内存空间、磁盘等，同一进程中的多条线程共享该进程的全部系统资源，进程之间是相互独立的，进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，进程是系统进行资源分配和调度的一个独立单元。进程是程序在计算机上的一次执行活动。当你运行一个程序,你就启动了一个进程。显然,程序是死的、静态的,进程是活的、动态的。进程可以分为系统进程和用户进程。凡是用于完成操作系统的各种功能的进程就是系统进程,它们就是处于运行状态下的操作系统本身,用户进程就是所有由你启动的进程。

线程是CPU调度的最小单元，必须依赖于进程而存在，线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的、能独立运行的基本单位。线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。



#### 并发与并行的区别

并发:指应用能够交替执行不同的任务,比如单CPU核心下执行多线程并非是同时执行多个任务,如果你开两个线程执行,就是在你几乎不可能察觉到的速度不断去切换这两个任务,已达到"同时执行效果",其实并不是的,只是计算机的速度太快,我们无法察觉到而已.

并行:指应用能够同时执行不同的任务,例:吃饭的时候可以边吃饭边打电话,这两件事情可以同时执行

两者区别:一个是交替执行,一个是同时执行.



作者：清风徐来
链接：
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



#### CPU密集型与IO密集型

1、CPU 密集型、计算密集型
 计算密集型，顾名思义就是应用需要非常多的CPU计算资源，在多核CPU时代，我们要让每一个CPU核心都参与计算，将CPU的性能充分利用起来，这样才算是没有浪费服务器配置，如果在非常好的服务器配置上还运行着单线程程序那将是多么重大的浪费。对于计算密集型的应用，完全是靠CPU的核数来工作，所以为了让它的优势完全发挥出来，避免过多的线程上下文切换，比较理想方案是：
线程数 = CPU核数+1
 也可以设置成CPU核数*2，这还是要看JDK的使用版本，以及CPU配置(服务器的CPU有超线程)。对于JDK1.8来说，里面增加了一个并行计算，计算密集型的较理想线程数 = CPU内核线程数*2

2、IO密集型
对于IO密集型的应用，就很好理解了，我们现在做的开发大部分都是WEB应用，涉及到大量的网络传输，不仅如此，与数据库，与缓存间的交互也涉及到IO，一旦发生IO，线程就会处于等待状态，当IO结束，数据准备好后，线程才会继续执行。因此从这里可以发现，对于IO密集型的应用，我们可以多设置一些线程池中线程的数量，这样就能让在等待IO的这段时间内，线程可以去做其它事，提高并发处理效率。
 那么这个线程池的数据量是不是可以随便设置呢？当然不是的，请一定要记得，线程上下文切换是有代价的。目前总结了一套公式，对于IO密集型应用：
线程数 = CPU核心数/(1-阻塞系数)
 这个阻塞系数一般为0.8~0.9之间，也可以取0.8或者0.9。套用公式，对于双核CPU来说，它比较理想的线程数就是20，当然这都不是绝对的，需要根据实际情况以及实际业务来调整。





